<div class="pedido-container">
  <!-- Header -->
  <header class="pedido-header">
    <div class="header-content">
      <button class="back-btn" (click)="goToMenu()">‚Üê Volver al Men√∫</button>
      <h1>Realizar Pedido</h1>
    </div>
  </header>

  <!-- Main Content -->
  <div class="pedido-content">
    <!-- Formulario de Pedido -->
    @if (!showSuccess) {
      <div class="pedido-form-section">
        <form (ngSubmit)="onSubmit()" class="pedido-form">
          <!-- Tipo de Pedido -->
          <div class="form-section">
            <h2 class="section-title">Tipo de Pedido</h2>
            <div class="radio-group">
              <label class="radio-label">
                <input 
                  type="radio" 
                  name="tipoPedido" 
                  value="DOMICILIO"
                  [(ngModel)]="pedidoForm.tipoPedido">
                <span class="radio-custom"></span>
                <span class="radio-text">üöö Domicilio</span>
              </label>
              <label class="radio-label">
                <input 
                  type="radio" 
                  name="tipoPedido" 
                  value="LOCAL"
                  [(ngModel)]="pedidoForm.tipoPedido">
                <span class="radio-custom"></span>
                <span class="radio-text">üè™ Local</span>
              </label>
            </div>
          </div>

          <!-- Informaci√≥n de Entrega -->
          <div class="form-section">
            <h2 class="section-title">Informaci√≥n de Entrega</h2>
            
            @if (pedidoForm.tipoPedido === 'DOMICILIO') {
              <div class="form-group">
                <label for="direccion">Direcci√≥n de Entrega *</label>
                <textarea 
                  id="direccion"
                  [(ngModel)]="pedidoForm.direccionEntrega"
                  name="direccionEntrega"
                  rows="3"
                  placeholder="Ingrese su direcci√≥n completa"
                  required></textarea>
              </div>

              <div class="form-group">
                <label for="instrucciones">Instrucciones de Entrega</label>
                <textarea 
                  id="instrucciones"
                  [(ngModel)]="pedidoForm.instruccionesEntrega"
                  name="instruccionesEntrega"
                  rows="2"
                  placeholder="Referencias, indicaciones, etc."></textarea>
              </div>
            }

            <div class="form-group">
              <label for="telefono">Tel√©fono de Contacto *</label>
              <input 
                type="tel"
                id="telefono"
                [(ngModel)]="pedidoForm.telefonoContacto"
                name="telefonoContacto"
                placeholder="999 999 999"
                required>
            </div>
          </div>

          <!-- M√©todo de Pago -->
          <div class="form-section">
            <h2 class="section-title">M√©todo de Pago</h2>
            <div class="radio-group">
              <label class="radio-label">
                <input 
                  type="radio" 
                  name="metodoPago" 
                  value="EFECTIVO"
                  [(ngModel)]="pedidoForm.metodoPago">
                <span class="radio-custom"></span>
                <span class="radio-text">üíµ Efectivo</span>
              </label>
              <label class="radio-label">
                <input 
                  type="radio" 
                  name="metodoPago" 
                  value="TARJETA"
                  [(ngModel)]="pedidoForm.metodoPago">
                <span class="radio-custom"></span>
                <span class="radio-text">üí≥ Tarjeta</span>
              </label>
              <label class="radio-label">
                <input 
                  type="radio" 
                  name="metodoPago" 
                  value="TRANSFERENCIA"
                  [(ngModel)]="pedidoForm.metodoPago">
                <span class="radio-custom"></span>
                <span class="radio-text">üè¶ Transferencia</span>
              </label>
            </div>

            @if (pedidoForm.metodoPago === 'EFECTIVO') {
              <div class="form-group">
                <label for="cambioPara">Cambio para (S/) *</label>
                <input 
                  type="number"
                  id="cambioPara"
                  [(ngModel)]="pedidoForm.cambioPara"
                  name="cambioPara"
                  step="0.01"
                  min="0"
                  placeholder="0.00"
                  required>
              </div>
            }
          </div>

          <!-- Resumen del Pedido -->
          <div class="form-section">
            <h2 class="section-title">Resumen del Pedido</h2>
            <div class="resumen-items">
              @for (item of cartItems; track item.plato.id) {
                <div class="resumen-item">
                  <div class="resumen-item-info">
                    <h4>{{ item.plato.nombre }}</h4>
                    <p>Cantidad: {{ item.cantidad }} √ó S/ {{ item.plato.precio }}</p>
                  </div>
                  <div class="resumen-item-total">
                    S/ {{ item.subtotal.toFixed(2) }}
                  </div>
                </div>
              }
            </div>
            <div class="resumen-total">
              <span class="total-label">Total:</span>
              <span class="total-amount">S/ {{ totalPrice.toFixed(2) }}</span>
            </div>
          </div>

          <!-- Error Message -->
          @if (errorMessage) {
            <div class="error-message">
              {{ errorMessage }}
            </div>
          }

          <!-- Submit Button -->
          <button 
            type="submit" 
            class="submit-btn"
            [disabled]="isLoading">
            @if (isLoading) {
              <span class="spinner-small"></span>
              Procesando...
            } @else {
              Confirmar Pedido
            }
          </button>
        </form>
      </div>
    }

    <!-- Pedido Creado Exitosamente -->
    @if (showSuccess && pedidoCreado) {
      <div class="success-section" id="pedido-resultado">
        <div class="success-icon">‚úÖ</div>
        <h2>¬°Pedido Realizado con √âxito!</h2>
        <p class="success-message">Tu pedido ha sido registrado correctamente</p>

        <div class="pedido-details">
          <div class="detail-card">
            <h3>Detalles del Pedido</h3>
            <div class="detail-item">
              <span class="detail-label">N√∫mero de Pedido:</span>
              <span class="detail-value">#{{ pedidoCreado.id }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Tipo:</span>
              <span class="detail-value">{{ pedidoCreado.tipoPedido }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Estado:</span>
              <span class="detail-value status-badge" [class]="'status-' + pedidoCreado.estado.toLowerCase()">
                {{ pedidoCreado.estado }}
              </span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Total:</span>
              <span class="detail-value total-highlight">S/ {{ pedidoCreado.total.toFixed(2) }}</span>
            </div>
            @if (pedidoCreado.direccionEntrega) {
              <div class="detail-item">
                <span class="detail-label">Direcci√≥n:</span>
                <span class="detail-value">{{ pedidoCreado.direccionEntrega }}</span>
              </div>
            }
            <div class="detail-item">
              <span class="detail-label">M√©todo de Pago:</span>
              <span class="detail-value">{{ pedidoCreado.metodoPago }}</span>
            </div>
          </div>

          @if (pedidoCreado.detalles && pedidoCreado.detalles.length > 0) {
            <div class="detail-card">
              <h3>Items del Pedido</h3>
              @for (detalle of pedidoCreado.detalles; track detalle.id) {
                <div class="detalle-item">
                  <div class="detalle-info">
                    <h4>{{ detalle.platoNombre || 'Plato' }}</h4>
                    <p>Cantidad: {{ detalle.cantidad }} √ó S/ {{ detalle.precioUnitario }}</p>
                  </div>
                  <div class="detalle-subtotal">
                    S/ {{ detalle.subtotal.toFixed(2) }}
                  </div>
                </div>
              }
            </div>
          }
        </div>

        <div class="success-actions">
          <button class="action-btn primary" (click)="goToPedidos()">
            Ver Mis Pedidos
          </button>
          <button class="action-btn secondary" (click)="goToMenu()">
            Seguir Comprando
          </button>
        </div>
      </div>
    }
  </div>
</div>

